import{r as T,u as Z,x as tt,d as v,e as t,a as l,g as c,q as w,f as b,b as d,l as P,c as p,o as n,F as V,p as C,t as o,v as K,j as O,n as M,B as q,z as et}from"./app-CfKzR4Wd.js";import{_ as rt}from"./AppLayout-DYFev4JA.js";import{_ as at}from"./Pagination-D92xaUDA.js";import{_ as st}from"./Modal-CcUlP8--.js";import{_ as H,a as I,b as G,c as ot}from"./PrimaryButton-SAVF0K6n.js";import{_ as it}from"./SecondaryButton-DTmFN6gd.js";import{l as lt}from"./lodash-DJbfzEvl.js";/* empty css            */import"./_commonjsHelpers-_d1bhYXs.js";import"./debounce-D0G5qrda.js";const dt={class:"px-4 sm:px-6 lg:px-8 py-6"},nt={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"},pt={class:"flex items-center gap-3"},xt=["href"],gt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6"},ct={class:"flex flex-col sm:flex-row sm:items-end gap-4"},mt={class:"flex-1 min-w-0"},ut={class:"relative"},yt=["value"],bt={class:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},ft={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},kt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},vt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},wt={class:"text-2xl font-bold text-emerald-700 dark:text-emerald-300 mt-1"},ht={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},_t={class:"text-2xl font-bold text-blue-700 dark:text-blue-300 mt-1"},St={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Pt={class:"text-2xl font-bold text-red-700 dark:text-red-300 mt-1"},Vt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},Ct={class:"overflow-x-auto"},Mt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ft={class:"divide-y divide-gray-200 dark:divide-gray-700"},At={class:"px-4 py-3 text-sm font-mono font-semibold text-indigo-600 dark:text-indigo-400"},Lt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap"},Et={class:"px-4 py-3"},Bt={class:"text-sm font-medium text-gray-900 dark:text-white"},Rt={class:"text-xs text-gray-500 dark:text-gray-400"},jt={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300"},Ut={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},zt={class:"px-4 py-3"},Dt={class:"flex flex-wrap gap-1 max-w-xs"},Nt={key:0,class:"text-xs text-gray-400"},$t={class:"px-4 py-3 text-sm text-right font-semibold text-gray-900 dark:text-white whitespace-nowrap"},Tt={class:"px-4 py-3 text-sm text-right font-medium text-blue-600 dark:text-blue-400 whitespace-nowrap"},Kt={class:"px-4 py-3 text-center"},Ot={key:0},qt={class:"px-6 py-4 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700"},Ht={class:"p-6"},It={class:"mt-6 space-y-4"},Gt={class:"mt-6 flex justify-end gap-3"},se={__name:"PrescriptionsTracking",props:{prescriptionsList:Object,secretaires:Array,prescriptionsFilters:Object},setup(m){const x=m,s=T({prescriptionSearch:x.prescriptionsFilters.prescriptionSearch||"",date_from:x.prescriptionsFilters.date_from||"",date_to:x.prescriptionsFilters.date_to||"",secretaire_id:x.prescriptionsFilters.secretaire_id||"",prescriptionsPerPage:x.prescriptionsFilters.prescriptionsPerPage||15}),y=()=>{et.get(route("admin.prescriptions-tracking.index"),{...s.value},{preserveState:!0,preserveScroll:!0,replace:!0})},F=lt.debounce(y,400),h=T(!1),i=Z({email:"",cc_emails:""}),J=()=>{i.clearErrors(),i.reset(),h.value=!0},_=()=>{h.value=!1,i.reset()},S=()=>{const a={...i.data(),date_from:s.value.date_from,date_to:s.value.date_to,secretaire_id:s.value.secretaire_id,prescriptionSearch:s.value.prescriptionSearch};i.transform(()=>a).post(route("admin.prescriptions.export.email"),{preserveScroll:!0,onSuccess:()=>{_()}})},Q=w(()=>{const a=new URLSearchParams;return s.value.date_from&&a.set("date_from",s.value.date_from),s.value.date_to&&a.set("date_to",s.value.date_to),s.value.secretaire_id&&a.set("secretaire_id",s.value.secretaire_id),s.value.prescriptionSearch&&a.set("prescriptionSearch",s.value.prescriptionSearch),route("admin.prescriptions.export")+"?"+a.toString()}),A=a=>!a.analyses||!a.analyses.length?[]:[...new Set(a.analyses.map(e=>e.code).filter(Boolean))],f=a=>a.montant_total||0,k=a=>(a.paiements||[]).reduce((e,g)=>e+(parseFloat(g.montant)||0),0),L=a=>Math.max(0,f(a)-k(a)),E=w(()=>(x.prescriptionsList.data||[]).reduce((a,e)=>a+f(e),0)),B=w(()=>(x.prescriptionsList.data||[]).reduce((a,e)=>a+k(e),0)),W=w(()=>Math.max(0,E.value-B.value)),u=a=>Number(a||0).toLocaleString("fr-FR"),X=a=>a?new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",R=a=>{const e=f(a),g=k(a);return g>=e&&e>0?"Payé":g>0?"Partiel":"Impayé"},Y=a=>{const e=R(a);return e==="Payé"?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-300":e==="Partiel"?"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"};return(a,e)=>(n(),tt(rt,null,{default:v(()=>{var g;return[t("div",dt,[t("div",nt,[e[10]||(e[10]=t("div",null,[t("h2",{class:"font-heading font-extrabold text-2xl text-gray-900 dark:text-white tracking-tight"}," Suivi des Prescriptions "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Suivez et gérez les prescriptions de tous les patients. ")],-1)),t("div",pt,[t("button",{onClick:J,type:"button",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-sm transition-colors"},[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1),c(" Envoyer par email ",-1)])]),t("a",{href:Q.value,target:"_blank",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg shadow-sm transition-colors"},[...e[9]||(e[9]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),c(" Exporter CSV ",-1)])],8,xt)])]),t("div",gt,[t("div",ct,[t("div",mt,[e[12]||(e[12]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Recherche",-1)),t("div",ut,[b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.value.prescriptionSearch=r),onInput:e[1]||(e[1]=(...r)=>d(F)&&d(F)(...r)),type:"text",placeholder:"Référence, patient, n° dossier...",class:"w-full pl-9 pr-4 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[P,s.value.prescriptionSearch]]),e[11]||(e[11]=t("svg",{class:"absolute left-3 top-2.5 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Date début",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.date_from=r),onChange:y,type:"date",class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[P,s.value.date_from]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Date fin",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.date_to=r),onChange:y,type:"date",class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[P,s.value.date_to]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Secrétaire",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.value.secretaire_id=r),onChange:y,class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},[e[15]||(e[15]=t("option",{value:""},"Tous",-1)),(n(!0),p(V,null,C(m.secretaires,r=>(n(),p("option",{key:r.id,value:r.id},o(r.name),9,yt))),128))],544),[[K,s.value.secretaire_id]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Par page",-1)),b(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.value.prescriptionsPerPage=r),onChange:y,class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white"},[...e[17]||(e[17]=[t("option",{value:"15"},"15",-1),t("option",{value:"30"},"30",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)])],544),[[K,s.value.prescriptionsPerPage]])])])]),t("div",bt,[t("div",ft,[e[19]||(e[19]=t("p",{class:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Total prescriptions",-1)),t("p",kt,o(m.prescriptionsList.total||0),1)]),t("div",vt,[e[21]||(e[21]=t("p",{class:"text-xs font-semibold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide"},"Montant total",-1)),t("p",wt,[c(o(u(E.value))+" ",1),e[20]||(e[20]=t("span",{class:"text-sm font-normal"},"Ar",-1))])]),t("div",ht,[e[23]||(e[23]=t("p",{class:"text-xs font-semibold text-blue-600 dark:text-blue-400 uppercase tracking-wide"},"Montant payé",-1)),t("p",_t,[c(o(u(B.value))+" ",1),e[22]||(e[22]=t("span",{class:"text-sm font-normal"},"Ar",-1))])]),t("div",St,[e[25]||(e[25]=t("p",{class:"text-xs font-semibold text-red-600 dark:text-red-400 uppercase tracking-wide"},"Reste à payer",-1)),t("p",Pt,[c(o(u(W.value))+" ",1),e[24]||(e[24]=t("span",{class:"text-sm font-normal"},"Ar",-1))])])]),t("div",Vt,[t("div",Ct,[t("table",Mt,[e[27]||(e[27]=t("thead",{class:"bg-gray-50 dark:bg-gray-900/50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Référence"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Date"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Patient"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Secrétaire"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Prescripteur"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Analyses"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Montant"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Payé"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Reste"),t("th",{class:"px-4 py-3 text-center text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Paiement")])],-1)),t("tbody",Ft,[(n(!0),p(V,null,C(m.prescriptionsList.data,r=>{var j,U,z,D,N;return n(),p("tr",{key:r.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",At,o(r.reference),1),t("td",Lt,o(X(r.created_at)),1),t("td",Et,[t("div",Bt,o((j=r.patient)==null?void 0:j.nom)+" "+o((U=r.patient)==null?void 0:U.prenom),1),t("div",Rt,o((z=r.patient)==null?void 0:z.numero_dossier),1)]),t("td",jt,o(((D=r.secretaire)==null?void 0:D.name)||"N/A"),1),t("td",Ut,o(((N=r.prescripteur)==null?void 0:N.nom)||"N/A"),1),t("td",zt,[t("div",Dt,[(n(!0),p(V,null,C(A(r),$=>(n(),p("span",{key:$,class:"inline-block px-1.5 py-0.5 text-xs font-semibold bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded"},o($),1))),128)),A(r).length?O("",!0):(n(),p("span",Nt,"—"))])]),t("td",$t,o(u(f(r)))+" Ar",1),t("td",Tt,o(u(k(r)))+" Ar",1),t("td",{class:M(["px-4 py-3 text-sm text-right font-medium whitespace-nowrap",L(r)>0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"])},o(u(L(r)))+" Ar",3),t("td",Kt,[t("span",{class:M([Y(r),"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold"])},o(R(r)),3)])])}),128)),(g=m.prescriptionsList.data)!=null&&g.length?O("",!0):(n(),p("tr",Ot,[...e[26]||(e[26]=[t("td",{colspan:"10",class:"px-4 py-12 text-center text-gray-500 dark:text-gray-400"},"Aucune prescription trouvée",-1)])]))])])]),t("div",qt,[l(at,{links:m.prescriptionsList.links},null,8,["links"])])]),l(st,{show:h.value,onClose:_},{default:v(()=>[t("div",Ht,[e[31]||(e[31]=t("h2",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Envoyer l'export par e-mail ",-1)),e[32]||(e[32]=t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," Le fichier CSV sera généré avec les filtres actuels et envoyé en pièce jointe. ",-1)),t("div",It,[t("div",null,[l(H,{for:"email",value:"Adresse Email Principale *"}),l(I,{id:"email",type:"email",class:"mt-1 block w-full",modelValue:d(i).email,"onUpdate:modelValue":e[6]||(e[6]=r=>d(i).email=r),required:"",placeholder:"exemple@domaine.com",onKeyup:q(S,["enter"])},null,8,["modelValue"]),l(G,{message:d(i).errors.email,class:"mt-2"},null,8,["message"])]),t("div",null,[l(H,{for:"cc_emails",value:"En copie (CC) - Optionnel"}),l(I,{id:"cc_emails",type:"text",class:"mt-1 block w-full",modelValue:d(i).cc_emails,"onUpdate:modelValue":e[7]||(e[7]=r=>d(i).cc_emails=r),placeholder:"email1@test.com, email2@test.com",onKeyup:q(S,["enter"])},null,8,["modelValue"]),e[28]||(e[28]=t("p",{class:"mt-1 text-xs text-gray-500"},"Séparez plusieurs adresses par des virgules.",-1)),l(G,{message:d(i).errors.cc_emails,class:"mt-2"},null,8,["message"])])]),t("div",Gt,[l(it,{onClick:_},{default:v(()=>[...e[29]||(e[29]=[c(" Annuler ",-1)])]),_:1}),l(ot,{class:M(["ml-3",{"opacity-25":d(i).processing}]),disabled:d(i).processing,onClick:S},{default:v(()=>[...e[30]||(e[30]=[c(" Envoyer ",-1)])]),_:1},8,["class","disabled"])])])]),_:1},8,["show"])])]}),_:1}))}};export{se as default};
