import{r as I,b as d,d as t,D as O,c as b,k as m,g as c,v as k,h as j,i as B,F as f,f as v,t as o,e as F,j as H,a as $,o as i,n as U}from"./app-DLV50I-f.js";import{_ as q}from"./Pagination-C9PCBzTj.js";import{l as G}from"./lodash-DJbfzEvl.js";/* empty css            */import"./_commonjsHelpers-_d1bhYXs.js";import"./debounce-D0G5qrda.js";const J={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6"},K=["href"],Q={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6"},W={class:"flex flex-col sm:flex-row sm:items-end gap-4"},X={class:"flex-1 min-w-0"},Y={class:"relative"},Z=["value"],tt={class:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},et={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},rt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},at={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},st={class:"text-2xl font-bold text-emerald-700 dark:text-emerald-300 mt-1"},ot={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},dt={class:"text-2xl font-bold text-blue-700 dark:text-blue-300 mt-1"},it={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},nt={class:"text-2xl font-bold text-red-700 dark:text-red-300 mt-1"},lt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},xt={class:"overflow-x-auto"},gt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},pt={class:"divide-y divide-gray-200 dark:divide-gray-700"},ct={class:"px-4 py-3 text-sm font-mono font-semibold text-indigo-600 dark:text-indigo-400"},ut={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap"},yt={class:"px-4 py-3"},bt={class:"text-sm font-medium text-gray-900 dark:text-white"},mt={class:"text-xs text-gray-500 dark:text-gray-400"},kt={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300"},ft={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},vt={class:"px-4 py-3"},ht={class:"flex flex-wrap gap-1 max-w-xs"},wt={key:0,class:"text-xs text-gray-400"},_t={class:"px-4 py-3 text-sm text-right font-semibold text-gray-900 dark:text-white whitespace-nowrap"},Pt={class:"px-4 py-3 text-sm text-right font-medium text-blue-600 dark:text-blue-400 whitespace-nowrap"},St={class:"px-4 py-3 text-center"},At={key:0},Vt={class:"px-6 py-4 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700"},Bt={__name:"DashboardPrescriptions",props:{prescriptions:Object,secretaires:Array,filters:Object},setup(x){const n=x,s=I({prescriptionSearch:n.filters.prescriptionSearch||"",date_from:n.filters.date_from||"",date_to:n.filters.date_to||"",secretaire_id:n.filters.secretaire_id||"",prescriptionsPerPage:n.filters.prescriptionsPerPage||15}),p=()=>{$.get(route("dashboard"),{...s.value},{preserveState:!0,preserveScroll:!0,replace:!0})},h=G.debounce(p,400),L=b(()=>{const a=new URLSearchParams;return s.value.date_from&&a.set("date_from",s.value.date_from),s.value.date_to&&a.set("date_to",s.value.date_to),s.value.secretaire_id&&a.set("secretaire_id",s.value.secretaire_id),s.value.prescriptionSearch&&a.set("prescriptionSearch",s.value.prescriptionSearch),route("admin.prescriptions.export")+"?"+a.toString()}),w=a=>!a.analyses||!a.analyses.length?[]:[...new Set(a.analyses.map(e=>e.code).filter(Boolean))],u=a=>a.montant_total||0,y=a=>(a.paiements||[]).reduce((e,l)=>e+(parseFloat(l.montant)||0),0),_=a=>Math.max(0,u(a)-y(a)),P=b(()=>(n.prescriptions.data||[]).reduce((a,e)=>a+u(e),0)),S=b(()=>(n.prescriptions.data||[]).reduce((a,e)=>a+y(e),0)),T=b(()=>Math.max(0,P.value-S.value)),g=a=>Number(a||0).toLocaleString("fr-FR"),z=a=>a?new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",A=a=>{const e=u(a),l=y(a);return l>=e&&e>0?"Payé":l>0?"Partiel":"Impayé"},E=a=>{const e=A(a);return e==="Payé"?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-300":e==="Partiel"?"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"};return(a,e)=>{var l;return i(),d("div",null,[t("div",J,[e[7]||(e[7]=O('<div><h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center"><span class="w-8 h-8 rounded-lg bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 flex items-center justify-center mr-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg></span> Suivi des Prescriptions </h3><p class="text-sm text-gray-500 dark:text-gray-400 mt-1 ml-11">Vérification financière — contrôle anti-vol</p></div>',1)),t("a",{href:L.value,target:"_blank",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg shadow-sm transition-colors"},[...e[6]||(e[6]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),m(" Exporter CSV ",-1)])],8,K)]),t("div",Q,[t("div",W,[t("div",X,[e[9]||(e[9]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Recherche",-1)),t("div",Y,[c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.value.prescriptionSearch=r),onInput:e[1]||(e[1]=(...r)=>j(h)&&j(h)(...r)),type:"text",placeholder:"Référence, patient, n° dossier...",class:"w-full pl-9 pr-4 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[k,s.value.prescriptionSearch]]),e[8]||(e[8]=t("svg",{class:"absolute left-3 top-2.5 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Date début",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.date_from=r),onChange:p,type:"date",class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[k,s.value.date_from]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Date fin",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.date_to=r),onChange:p,type:"date",class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},null,544),[[k,s.value.date_to]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Secrétaire",-1)),c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.value.secretaire_id=r),onChange:p,class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500"},[e[12]||(e[12]=t("option",{value:""},"Tous",-1)),(i(!0),d(f,null,v(x.secretaires,r=>(i(),d("option",{key:r.id,value:r.id},o(r.name),9,Z))),128))],544),[[B,s.value.secretaire_id]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1 uppercase tracking-wide"},"Par page",-1)),c(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.value.prescriptionsPerPage=r),onChange:p,class:"px-3 py-2 text-sm bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white"},[...e[14]||(e[14]=[t("option",{value:"15"},"15",-1),t("option",{value:"30"},"30",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)])],544),[[B,s.value.prescriptionsPerPage]])])])]),t("div",tt,[t("div",et,[e[16]||(e[16]=t("p",{class:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide"},"Total prescriptions",-1)),t("p",rt,o(x.prescriptions.total||0),1)]),t("div",at,[e[18]||(e[18]=t("p",{class:"text-xs font-semibold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide"},"Montant total",-1)),t("p",st,[m(o(g(P.value))+" ",1),e[17]||(e[17]=t("span",{class:"text-sm font-normal"},"Ar",-1))])]),t("div",ot,[e[20]||(e[20]=t("p",{class:"text-xs font-semibold text-blue-600 dark:text-blue-400 uppercase tracking-wide"},"Montant payé",-1)),t("p",dt,[m(o(g(S.value))+" ",1),e[19]||(e[19]=t("span",{class:"text-sm font-normal"},"Ar",-1))])]),t("div",it,[e[22]||(e[22]=t("p",{class:"text-xs font-semibold text-red-600 dark:text-red-400 uppercase tracking-wide"},"Reste à payer",-1)),t("p",nt,[m(o(g(T.value))+" ",1),e[21]||(e[21]=t("span",{class:"text-sm font-normal"},"Ar",-1))])])]),t("div",lt,[t("div",xt,[t("table",gt,[e[24]||(e[24]=t("thead",{class:"bg-gray-50 dark:bg-gray-900/50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Référence"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Date"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Patient"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Secrétaire"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Prescripteur"),t("th",{class:"px-4 py-3 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Analyses"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Montant"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Payé"),t("th",{class:"px-4 py-3 text-right text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Reste"),t("th",{class:"px-4 py-3 text-center text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},"Paiement")])],-1)),t("tbody",pt,[(i(!0),d(f,null,v(x.prescriptions.data,r=>{var V,M,C,D,R;return i(),d("tr",{key:r.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",ct,o(r.reference),1),t("td",ut,o(z(r.created_at)),1),t("td",yt,[t("div",bt,o((V=r.patient)==null?void 0:V.nom)+" "+o((M=r.patient)==null?void 0:M.prenom),1),t("div",mt,o((C=r.patient)==null?void 0:C.numero_dossier),1)]),t("td",kt,o(((D=r.secretaire)==null?void 0:D.name)||"N/A"),1),t("td",ft,o(((R=r.prescripteur)==null?void 0:R.nom)||"N/A"),1),t("td",vt,[t("div",ht,[(i(!0),d(f,null,v(w(r),N=>(i(),d("span",{key:N,class:"inline-block px-1.5 py-0.5 text-xs font-semibold bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded"},o(N),1))),128)),w(r).length?F("",!0):(i(),d("span",wt,"—"))])]),t("td",_t,o(g(u(r)))+" Ar",1),t("td",Pt,o(g(y(r)))+" Ar",1),t("td",{class:U(["px-4 py-3 text-sm text-right font-medium whitespace-nowrap",_(r)>0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"])},o(g(_(r)))+" Ar",3),t("td",St,[t("span",{class:U([E(r),"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold"])},o(A(r)),3)])])}),128)),(l=x.prescriptions.data)!=null&&l.length?F("",!0):(i(),d("tr",At,[...e[23]||(e[23]=[t("td",{colspan:"10",class:"px-4 py-12 text-center text-gray-500 dark:text-gray-400"},"Aucune prescription trouvée",-1)])]))])])]),t("div",Vt,[H(q,{links:x.prescriptions.links},null,8,["links"])])])])}}};export{Bt as default};
