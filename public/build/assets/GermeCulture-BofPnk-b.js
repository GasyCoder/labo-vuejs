import{G as P,i as V,c as o,d as e,g as h,p as q,F as p,f as v,t as c,r as b,I as k,o as l,n as F,e as O,k as W,x as E,v as K}from"./app-CepxlqUZ.js";/* empty css            */import"./_commonjsHelpers-_d1bhYXs.js";import"./debounce-D0G5qrda.js";const Q={class:"space-y-6 pt-2"},X={class:"flex justify-end mb-2"},Y={class:"flex flex-wrap gap-2"},Z=["onClick"],I={key:0,class:"p-4 bg-white dark:bg-slate-800 rounded-lg border border-yellow-200 dark:border-yellow-700"},ee=["value"],te={class:"space-y-4"},se={key:0,class:"p-4 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl"},re={class:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2"},ae={class:"flex flex-wrap gap-2"},oe=["onClick","disabled"],le={key:1,class:"border-t border-yellow-200 dark:border-yellow-800 pt-6"},ne={class:"flex items-center justify-between gap-3 mb-4"},ie={class:"flex items-center gap-3"},de={class:"text-base font-semibold text-green-800 dark:text-green-200"},ue=["disabled"],ce={key:0,class:"p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 text-orange-800 dark:text-orange-300 rounded-lg text-sm"},be={key:1,class:"space-y-4"},pe=["onClick"],me={class:"flex items-center justify-between"},ge={class:"flex items-center gap-3"},ve={class:"font-semibold text-green-800 dark:text-green-200"},xe={class:"p-0 bg-slate-50 dark:bg-slate-900"},he={key:0,class:"p-6 text-center text-sm text-slate-500"},ke={key:1,class:"p-4"},fe={class:"flex flex-wrap gap-3 items-end mb-4 bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700"},ye={class:"flex-1 min-w-[200px]"},we=["onUpdate:modelValue"],_e=["value"],Ce={class:"w-24"},Se=["onUpdate:modelValue"],Ae={class:"w-24"},Ve=["onUpdate:modelValue"],qe=["onClick"],Fe={key:0,class:"overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700"},Oe={class:"w-full text-sm text-left"},je={class:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900"},Ne={class:"px-4 py-2 font-medium text-slate-900 dark:text-slate-100"},ze={class:"px-4 py-2 text-center"},De=["value","onChange"],Be={class:"px-4 py-2 text-center"},Re=["value","onChange"],Ee={class:"px-4 py-2 text-center"},Me=["onClick"],Ue={key:1,class:"text-center p-6 bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700"},Le={__name:"GermeCulture",props:{analyse:Object,prescriptionId:Number,familles:Array,getFormValue:Function,setFormValue:Function},setup(N){const n=N,z=[{value:"non-rechercher",label:"Non rechercher"},{value:"en-cours",label:"En cours"},{value:"culture-sterile",label:"Culture st√©rile"},{value:"absence-germe-pathogene",label:"Absence de germe pathog√®ne"},{value:"Autre",label:"Autre (pr√©ciser)"}],M=()=>{let r=n.getFormValue(n.analyse.id,"resultats");if(!r)return[];if(typeof r=="string")try{r=JSON.parse(r)}catch{r=[]}return Array.isArray(r)?r:[]},d=V(()=>M()),D=V(()=>n.getFormValue(n.analyse.id,"valeur")||""),m=V(()=>d.value.filter(r=>r.startsWith("bacterie-")).map(r=>parseInt(r.replace("bacterie-","")))),f=V(()=>d.value.some(r=>z.map(t=>t.value).includes(r))),y=b(!1),U=()=>{confirm("√ätes-vous s√ªr de vouloir r√©initialiser cette analyse bact√©riologique ?")&&(n.setFormValue(n.analyse.id,"resultats",JSON.stringify([])),n.setFormValue(n.analyse.id,"valeur",""),y.value=!0)},$=r=>{let t=[...d.value];t.includes(r)?t=t.filter(s=>s!==r):t.push(r),n.setFormValue(n.analyse.id,"resultats",JSON.stringify(t))},H=r=>{n.setFormValue(n.analyse.id,"valeur",r)},J=r=>{if(f.value)return;const t="bacterie-"+r;let s=[...d.value];s.includes(t)?s=s.filter(i=>i!==t):s.push(t),n.setFormValue(n.analyse.id,"resultats",JSON.stringify(s)),y.value=!0},w=b(!1),x=b({}),j=b({}),B=async()=>{w.value=!0;try{if((await k.post(route("technicien.resultats.antibiogrammes.sync"),{prescription_id:n.prescriptionId,analyse_id:n.analyse.id,bacteries:m.value})).data.success){y.value=!1;for(const s of m.value)await _(s)}}catch(r){console.error("Erreur sync antibiogrammes",r)}finally{w.value=!1}},_=async r=>{j.value[r]=!0;try{const s=(await k.post(route("technicien.resultats.antibiogrammes.data"),{prescription_id:n.prescriptionId,analyse_id:n.analyse.id,bacterie_id:r})).data;s.success&&(x.value[r]=s)}catch(t){console.error("Erreur fetch antibiogramme data",t)}finally{j.value[r]=!1}};P(()=>{m.value.length>0&&B()});const g=b([]),G=r=>{g.value.includes(r)?g.value=g.value.filter(t=>t!==r):g.value.push(r)},C=b({}),S=b({}),A=b({}),L=async r=>{const t=C.value[r],s=S.value[r]||"S",i=A.value[r]||"";if(!t)return alert("Veuillez s√©lectionner un antibiotique");try{const u=(await k.post(route("technicien.resultats.antibiogrammes.add"),{prescription_id:n.prescriptionId,analyse_id:n.analyse.id,bacterie_id:r,antibiotique_id:t,interpretation:s,diametre_mm:i})).data;u.success?(C.value[r]="",S.value[r]="S",A.value[r]="",await _(r)):alert("Erreur: "+(u.error||"inconnue"))}catch(a){console.error(a)}},R=async(r,t,s,i)=>{try{(await k.put(route("technicien.resultats.antibiogrammes.update",t),{field:s,value:i})).data.success&&await _(r)}catch(a){console.error(a)}},T=async(r,t)=>{if(confirm("√ätes-vous s√ªr de vouloir retirer cet antibiotique ?"))try{(await k.delete(route("technicien.resultats.antibiogrammes.delete",t))).data.success&&await _(r)}catch(s){console.error(s)}};return(r,t)=>(l(),o("div",Q,[e("div",X,[d.value.length||D.value?(l(),o("button",{key:0,onClick:U,class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg transition-all duration-200"},[...t[1]||(t[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),q(" R√©initialiser la s√©lection ",-1)])])):h("",!0)]),e("div",null,[t[2]||(t[2]=e("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},"Options standards (exclusives)",-1)),e("div",Y,[(l(),o(p,null,v(z,s=>e("button",{key:s.value,onClick:i=>$(s.value),class:F(["px-3 py-1.5 rounded-full text-xs font-medium border transition",d.value.includes(s.value)?"bg-yellow-600 text-white border-yellow-700":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"])},c(s.label),11,Z)),64))])]),d.value.includes("Autre")?(l(),o("div",I,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},"Pr√©cisez la bact√©rie non list√©e",-1)),e("input",{type:"text",value:D.value,onInput:t[0]||(t[0]=s=>H(s.target.value)),class:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-slate-100 placeholder-slate-400 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors",placeholder:"Ex: Enterococcus faecalis, Candida albicans..."},null,40,ee)])):h("",!0),e("div",te,[(l(!0),o(p,null,v(N.familles,s=>(l(),o(p,{key:s.id},[s.bacteries&&s.bacteries.length>0?(l(),o("div",se,[e("div",re,c(s.designation),1),e("div",ae,[(l(!0),o(p,null,v(s.bacteries,i=>(l(),o("button",{key:i.id,onClick:a=>J(i.id),disabled:f.value,class:F(["px-3 py-1.5 rounded-full text-xs font-medium border transition",d.value.includes("bacterie-"+i.id)?"bg-green-600 text-white border-green-700 shadow-sm":f.value?"bg-slate-100 dark:bg-slate-900/40 text-slate-400 border-slate-200 opacity-60 cursor-not-allowed":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-300 dark:border-slate-600 hover:bg-slate-100 hover:border-slate-400"])},c(i.designation),11,oe))),128))])])):h("",!0)],64))),128))]),m.value.length>0&&!f.value?(l(),o("div",le,[e("div",ne,[e("div",ie,[t[5]||(t[5]=e("div",{class:"w-8 h-8 bg-green-500 dark:bg-green-600 rounded-lg flex items-center justify-center text-white text-sm font-bold shadow-sm"},"ü¶†",-1)),e("div",null,[e("h5",de,"Antibiogrammes ("+c(m.value.length)+")",1),t[4]||(t[4]=e("p",{class:"text-xs text-green-700 dark:text-green-300"},"Cliquez sur Synchroniser pour charger les tableaux.",-1))])]),e("button",{onClick:B,disabled:w.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-60 text-white text-sm font-medium rounded-lg transition-colors shadow-sm"},c(w.value?"Synchronisation‚Ä¶":"Synchroniser"),9,ue)]),y.value?(l(),o("div",ce,[...t[6]||(t[6]=[q(" ‚ö†Ô∏è S√©lection modifi√©e ‚Äî veuillez cliquer sur ",-1),e("strong",null,"Synchroniser",-1),q(" pour mettre √† jour les antibiogrammes. ",-1)])])):(l(),o("div",be,[(l(!0),o(p,null,v(m.value,(s,i)=>(l(),o("div",{key:s,class:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm"},[e("button",{onClick:a=>G(s),class:"w-full px-6 py-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-b border-green-100 dark:border-green-800 text-left hover:from-green-100 dark:hover:from-green-900/40 transition-colors focus:outline-none"},[e("div",me,[e("div",ge,[t[7]||(t[7]=e("div",{class:"w-6 h-6 bg-green-500 dark:bg-green-600 rounded-md flex items-center justify-center text-white text-xs font-bold"},"ü¶†",-1)),e("div",null,[e("h6",ve,"Bact√©rie ID: "+c(s),1)])]),(l(),o("svg",{class:F(["w-5 h-5 text-green-600 transition-transform duration-200",{"rotate-180":g.value.includes(s)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[8]||(t[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])],8,pe),O(e("div",xe,[j.value[s]?(l(),o("div",he,[...t[9]||(t[9]=[e("div",{class:"w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"},null,-1),q("Chargement des donn√©es...",-1)])])):x.value[s]?(l(),o("div",ke,[e("div",fe,[e("div",ye,[t[11]||(t[11]=e("label",{class:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1"},"Antibiotique",-1)),O(e("select",{"onUpdate:modelValue":a=>C.value[s]=a,class:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-sm dark:text-white"},[t[10]||(t[10]=e("option",{value:""},"Choisir...",-1)),(l(!0),o(p,null,v(x.value[s].antibiotiquesDisponibles,a=>(l(),o("option",{key:a.id,value:a.id},c(a.designation),9,_e))),128))],8,we),[[E,C.value[s]]])]),e("div",Ce,[t[13]||(t[13]=e("label",{class:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1"},"Interpr√©tation",-1)),O(e("select",{"onUpdate:modelValue":a=>S.value[s]=a,class:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-sm dark:text-white"},[...t[12]||(t[12]=[e("option",{value:"S"},"S",-1),e("option",{value:"I"},"I",-1),e("option",{value:"R"},"R",-1)])],8,Se),[[E,S.value[s]]])]),e("div",Ae,[t[14]||(t[14]=e("label",{class:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1"},"√ò (mm)",-1)),O(e("input",{type:"number","onUpdate:modelValue":a=>A.value[s]=a,step:"0.1",class:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-sm dark:text-white",placeholder:"15.5"},null,8,Ve),[[K,A.value[s]]])]),e("button",{onClick:a=>L(s),class:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium transition-colors"},"Ajouter",8,qe)]),x.value[s].resultats.length>0?(l(),o("div",Fe,[e("table",Oe,[t[17]||(t[17]=e("thead",{class:"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-xs uppercase font-semibold"},[e("tr",null,[e("th",{class:"px-4 py-3"},"Antibiotique"),e("th",{class:"px-4 py-3 text-center"},"Interpr√©tation"),e("th",{class:"px-4 py-3 text-center"},"Diam√®tre (mm)"),e("th",{class:"px-4 py-3 text-center"},"Actions")])],-1)),e("tbody",je,[(l(!0),o(p,null,v(x.value[s].resultats,a=>(l(),o("tr",{key:a.id,class:"hover:bg-slate-50 dark:hover:bg-slate-800/50"},[e("td",Ne,c(a.antibiotique_designation),1),e("td",ze,[e("select",{value:a.interpretation,onChange:u=>R(s,a.id,"interpretation",u.target.value),class:F(["px-2 py-1 text-xs font-bold rounded border dark:border-slate-600 focus:ring-0",{"bg-green-50 text-green-700":a.interpretation==="S","bg-yellow-50 text-yellow-700":a.interpretation==="I","bg-red-50 text-red-700":a.interpretation==="R"}])},[...t[15]||(t[15]=[e("option",{value:"S"},"S",-1),e("option",{value:"I"},"I",-1),e("option",{value:"R"},"R",-1)])],42,De)]),e("td",Be,[e("input",{type:"number",step:"0.1",value:a.diametre_mm,onChange:u=>R(s,a.id,"diametre_mm",u.target.value),class:"w-16 px-2 py-1 text-center text-xs border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800 dark:text-white",placeholder:"-"},null,40,Re)]),e("td",Ee,[e("button",{onClick:u=>T(s,a.id),class:"text-red-500 hover:text-red-700 p-1 bg-red-50 dark:bg-red-900/30 rounded"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,Me)])]))),128))])])])):(l(),o("div",Ue,[...t[18]||(t[18]=[e("p",{class:"text-sm text-slate-500"},"Aucun antibiotique test√©. Utilisez le formulaire pour en ajouter.",-1)])]))])):h("",!0)],512),[[W,g.value.includes(s)||i===0]])]))),128))]))])):h("",!0)]))}};export{Le as default};
